!function(a){var b=new SQ.Class;b.include(a.extend({isLogin:!1,info:null,init:function(c){var d=this.options=a.extend(!0,{},{logTpl:"",logedTpl:b.logedTpl,logFrame:null,gameId:0,text:[],gameName:"",closeServer:!1,parseTpl:null,regDialog:!0,regBtn:null},c);return d.logFrame?(this.needsLogTpl=!d.logFrame.find("*").length,"string"!=typeof d.logTpl&&this.needsLogTpl?SQ.log&&SQ.log("unifylog: 登录器模版的值不合法"):(this.log=a(d.logTpl),2===d.text.length||d.gameName?(d.gameName&&(d.text=["您上次进入的服是：","37"+d.gameName+"推荐您进入："]),void 0):SQ.log&&SQ.log("unifylog: text is invalid"))):SQ.log&&SQ.log("unifylog: logFrame is null")},userInfo:function(){var a=this,b=a.options;this.isLogin?a.needsLogTpl&&(b.logFrame.append(a.log),a.trigger("parseLog")):SQ.Login.getUserInfo({gameid:b.gameId},function(b){a._parse(b)},function(){b.regDialog&&a._dialog(),a.trigger("unLogin"),a.needsLogTpl&&(b.logFrame.append(a.log),a.trigger("parseLog"))})},toLog:function(a,b,c){var d=this;SQ.Login.toLog({login_account:a,password:b,remember_me:1,save_state:c?1:0,gameid:this.options.gameId,success:function(a){d._parse(a)},fail:function(a){a&&a.msg&&alert(a.msg)}})},toOut:function(){var b=this;SQ.Login.toOut(function(){b.loged.remove(),b.loged=null,a.contains(b.options.logFrame[0],b.log[0])||b.log.appendTo(b.options.logFrame[0]),b.log.show()})},_parse:function(b){this.isLogin=!0;var c=b.HISTORY_HOT_GAMESERVER,d=this.options.closeServer?"已经关服，去游戏大厅看其他游戏":"暂未开服，敬请期待",e=this.options.closeServer?"http://www.37.com/game/":"javascript:alert('暂未开服，敬请期待')",f=c.length?c[0].SERVER_NAME+'<span style="color:#f00"> 火爆开启 </span>':d,g=c.length?c[0].SERVER_URL:e,h=this.options.text[c.length?c[0].HOTSORT:1],i=d===!c.length?"":"target='_blank'",j=this.options.logedTpl.replace("{$username}",b.LOGIN_ACCOUNT).replace("{$time}",b.LAST_LOGIN_TIME).replace("{$serverurl}",g).replace("{$servername}",f).replace("{$text}",h).replace("{$serverblank}",i);"function"==typeof this.options.parseTpl&&(j=this.options.parseTpl.call(this,j)),this.loged=a(j).appendTo(this.options.logFrame),this.log.hide().find(":password").val(""),this.info=b,this.trigger("parsed",this.isLogin,b)},_dialog:function(){if(SQ.Statis&&SQ.Statis.hasAdReferer()){var b,c=this;a("head").append('<style>div, ul, li, p {margin:0;padding:0;}.r-dialog {color:#667382;font-family:"Microsoft Yahei",Arial,Helvetica,sans-serif;}.r-dialog input {outline:none;vertical-align:middle;}.r-dialog .star {font:12px "simsun";color:#ffa300;margin-right:3px;}.r-dialog a {text-decoration:none;color:#667382;}.r-dialog a:hover {text-decoration:underline;color:#667382;}.r-dialog-t {list-style:none;zoom:1;}.r-dialog-t:after {content:"";display:block;font-size:0;clear:both;}.r-dialog .ac {text-align:center;}.r-dialog .btn {width:145px;display:inline-block;text-align:center;overflow:hidden;height:44px;line-height:44px;color:#4e4e4c;font-size:18px;vertical-align:middle;background:transparent url(http://img1.37wanimg.com/www/css/images/common/btn-24.png) 0 -527px;_background-image:url(http://img1.37wanimg.com/www/css/images/common/btn.png);}.r-dialog .btn:hover {background-position:0 -572px;text-decoration:none;}</style>'),b=this.logDialog=SQ.Login.Dialog({gameid:c.options.gameId,hideId:!0,logSuccess:function(a){c._parse(a)},regSuccess:function(a){c._parse(a)}}),this.options.regBtn&&a(document).on("click",this.options.regBtn,function(a){a.preventDefault(),b.show(1)})}}},SQ.Events)),b.extend({logedTpl:'<div class="loged"><div class="con"><ul><li>您好&nbsp;<span class="font_1 color colored">{$username}</span></li><li><a href="http://my.37.com/user/userprotect.php" title="完善密保资料" target="_blank">完善密保资料</a></li><li>登录时间：<span class="font_1 color colored">{$time}</span></li><li>{$text}</li><li><a href="{$serverurl}" {$serverblank}>{$servername}</a></li><li class="li_r align-r"><a href="http://my.37.com/user/" title="用户中心" target="_blank">用户中心</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id="logout" onclick="userloginout();" title="注销" style="cursor:pointer;">注销</a></li></ul></div><div class="log_btm"></div></div>',ingameLog:function(a,b,c,d,e){if(""===a)return alert("请输入用户名");var f=SQ.Login.checkPassword(b);if(f!==!0)return alert(f);var g={login_account:a,password:b,save_state:c||0,remember_me:1,success:function(){d?parent.window.location.href=location.href:parent.window.location.reload()},fail:function(a){a&&a.msg&&alert(a.msg)}};e&&(g.gameid=e),SQ.Login.toLog(g)},getStaticServer:function(b,c,d,e){if(b&&c&&"function"==typeof c){var f="http://ptres.37.com/content/cache/game_server/"+b+".js",g="game_server_callback_"+b;a.ajax({url:f,cache:!1,dataType:"jsonp",jsonpCallback:g}).done(function(a){if(a&&a.data){if(e){var b=a.data,f=[];for(var g in b)b[g].STATE==e&&f.push(b[g]);a.data=f}d&&(a.data=a.data.slice(0,d)),c.call(this,a)}})}}}),SQ.UnifyLog=b}(jQuery);