!function(a,b){var c,d=window.location,e={version:"1.2.2",Track:{},Trigger:{url:"http://a.clickdata.37wan.com/controller/istat.controller.php",defaults:{platform:"37wan",item:"",game_id:"",sid:"",position:"",ext_1:"",ext_2:"",ext_3:"",ext_4:"",ext_5:"",ext_6:"",login_account:"",browser_type:"",user_ip:""}},convertMap:{baidu_pinpai:"baidu_ppzq"},getDocReferrer:function(a){var b="",c=a||document.referrer;return c&&(b=c.split("://")[1].split("/"),b=a?b[0]+"/"+b[1]:b[0]),b},convertPathToDomain:function(a){var b="",c=/^www.37.com\/([0-9a-z]+)$/;return a=this.getDocReferrer(a),c.test(a)&&(b=a.split("/")[1]+".37.com"),b},addDom:function(b,c,d){c=c||"script",this.d&&d&&document.body.removeChild(this.d),b&&(this.d=document.createElement(c),"script"===c?this.d.type="text/javascript":this.d.style.display="none",this.d.src=b+(b.indexOf("?")>-1?"&t=":"?t=")+a.now(),document.body.appendChild(this.d))},referCookie:"37wanrefer",setReferer:function(a){var c,e,f,g,h,i,j,k,l,m,n=document.referrer,o=d.search,p=/^https?:\/\/(?:www|search)\.(baidu|soso|sogou|google|so|youdao|jike|panguso).+(?:\?|&)(?:wd|q|query)=([^&]+)/;if(/(\?|&)(source|refer(er)?)=\S+/.test(o)){for(h=["refer","uid","ad_param","wd","ad_type"],i=0,j=h.length,g=[],l=b.queryToJson(o),i;j>i;i++)c=l[h[i]]||l.referer||l.source,g.push((0===i?this.convertMap[c]||c:l[h[i]])||"");g=g.join("|")}else k=this.getDocReferrer(),k?(f=k.split("."),e=f.length,"http://www.pz1g.com/js/37.com"!==f.splice(e-2,2).join(".")?(m=p.exec(n),g=m&&m[1]&&m[2]?k+"|||"+m[2]+"|":k):g=""):g=a?this.convertPathToDomain(d.href):d.host;return g&&b.cookie(this.referCookie,g,{path:"/",domain:"http://www.pz1g.com/js/37.com"}),g},getReferer:function(){return b.cookie(this.referCookie)},updateReferer:function(a,c){var d=this.getReferer();d&&(d=d.split("|"),d[a]=c,b.cookie(this.referCookie,d.join("|"),{path:"/",domain:"http://www.pz1g.com/js/37.com"}))},hasAdReferer:function(a){var b=this.getReferer();return/(\?|&)(source|refer(er)?)=\S+/.test(a||d.href)||b&&b.indexOf("|")>-1&&-1===b.split("|")[0].indexOf(".")},delReferer:function(){b.cookie(this.referCookie,null,{path:"/",domain:"http://www.pz1g.com/js/37.com"})}};e.Source=b.Class.create({dataUrl:"../../ptres.37.com/js/sq/modules/game_source.js"/*tpa=http://ptres.37.com/js/sq/modules/game_source.js*/,sourceCookie:"37tg_param",init:function(d,e,f,g){var h=b.cookie(this.sourceCookie),i=b.getParam("source");this.cookieParam=b.queryToJson(h),this.param=f||[],this.$link=d,this.source=i||this.cookieParam.source,g=g||this.dataUrl,d&&d.length&&e&&this.source&&a.getScript(g,a.proxy(function(){this.targetUrl=c[e][this.source],h?this._getCookie():this._setCookie()},this))},_getCookie:function(){delete this.cookieParam.source,this._setBtn(this.cookieParam)},_setCookie:function(){b.cookie(this.sourceCookie,"?source="+this.source+"&"+this._parseParam(),{path:"/"}),this._setBtn()},_setBtn:function(a){this.$link.prop("href",this._addParam(a))},_addParam:function(a){return this.targetUrl?this.targetUrl.indexOf("?")>-1?this.targetUrl+"&"+this._parseParam(a):this.targetUrl+"?"+this._parseParam(a):b.log&&b.log("注册按钮：找不到对应的 url ")},_parseParam:function(c){var d,e=0,f=this.param,g=f.length;if(c=c||{},a.isEmptyObject(c))for(;g>e;e++)d=f[e],c[d]=b.getParam(d);return a.param(c)}},{getSource:function(a){c=a}}),e.Track.Ad=b.Class.create({param:["click_type","web_r"],adUrl:"http://www.37.com/test/checkin.php",paramReferrer:"web_urlrefer",init:function(a,b){this.url=b||d.href,this.param=a||this.param,this._parseParam(this.param)},_parseParam:function(a){for(var c,d=0,f=a.length,g={};f>d;d++)c=a[d],g[c]=b.getParam(c,this.url);g[this.paramReferrer]=e.getDocReferrer(),this._request(g)},_request:function(b){e.addDom(this.adUrl+"?"+a.param(b))}}),e.Trigger.Download=b.Class.create({init:function(c,d,f){this.downLoadUrl=f||c.attr("data-url"),c.on("click",a.proxy(function(c){if(c.preventDefault(),"string"http://www.pz1g.com/js/==typeof d)return this._download(d),void 0;var f=a.extend({},e.Trigger.defaults,d);return f.item?(this._download(e.Trigger.url+"?"+a.param(f)),void 0):b.log&&b.log("没有统计关键参数 item")},this))},_download:function(a){e.addDom(a),e.addDom(this.downLoadUrl,"iframe")}}),e.Trigger.Click=b.Class.create({init:function(b,c){b.on("click",a.proxy(function(d){var f=b.attr("target");if(a.nodeName(b[0],"a")&&!f&&(d.preventDefault(),this.refresh=b[0].href),"string"http://www.pz1g.com/js/==typeof c)return this._request(c),void 0;var g=a.extend({},e.Trigger.defaults,c);return g.item?(this._request(e.Trigger.url+"?"+a.param(g)),void 0):alert("没有统计关键参数 item")},this))},_request:function(a){e.addDom(a),this.refresh&&(d.href=this.refresh,this.refresh="")}}),e.Trigger.Load=b.Class.create({init:function(b){if("string"http://www.pz1g.com/js/==typeof b)return this._request(b),void 0;var c=a.extend({},e.Trigger.defaults,b);return c.item?(this._request(e.Trigger.url+"?"+a.param(c)),void 0):alert("没有统计关键参数 item")},_request:function(a){e.addDom(a)}}),e.Online=b.Class.create({init:function(c){if("object"!=typeof c)return b.log("param error!"),void 0;var d=a.extend({},{login_account:"",game_server_id:"",ext:""},c);if(!d.login_account||!d.game_server_id)return b.log("没有统计关键参数 login_account或game_server_id"),void 0;this.interval=6e4,d.login_account=encodeURIComponent(d.login_account),d.game_server_id=parseInt(d.game_server_id,10);var e="http://ol.37wan.com/checkin?"+a.param(d);this.run(e)},run:function(a){e.addDom(a,"script",1);var b=this;window.setTimeout(function(){b.run(a)},b.interval)}}),b.Statis=e;var f=b.byId("sq-statis-refer");f&&b.Statis.setReferer(f.getAttribute("data-path"))}(jQuery,SQ);