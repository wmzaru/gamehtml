!function(a,b){"use strict";var c,d=document,e=a(d),f=window.location;c=b.gameId?b.gameId:a("body").attr("data-gameid");var g={tLog:a("span.t-log:first"),init:function(){this.eventClick(),this.apiCommonData(),this.topLogin.init(),this.tuiguang(),this.topMenu()},loginSuccess:function(a){g.topLogin.parse(a)},topLogin:{init:function(){g.tLog.length||(g.tLog=a("span.t-log:first")),this.dialog=new b.Login.Dialog({gameid:c,logSuccess:function(a){window.unifyLog?window.unifyLog._parse(a):f.reload()},regSuccess:function(a){window.unifyLog?window.unifyLog._parse(a):f.reload()}}),this.events()},events:function(){var a=this;e.on("click","a.t-login, a.t-reg",function(b){b.preventDefault(),a.dialog.show(this.className.indexOf("reg")>-1?1:0)}).on("click","a.t-log-out",function(a){a.preventDefault(),b.Login.toOut(function(){window.unifyLog?(window.unifyLog.toOut(),g.tLog&&g.tLog.show().prev().hide()):f.reload()})})},parse:function(b){var c=g.tLog,d=c.prev();if(c.length){c.hide();var e=b.LOGIN_ACCOUNT;e.length>12&&(e=e.substr(0,12)+"..."),d.find("b").eq(0).text(e).attr("title",b.LOGIN_ACCOUNT).end().end().css("display","inline-block"),d.find(".t-loged-vip:first").text(0!==b.VIP_DEEP?b.VIP_DEEP:"").addClass(0!==b.VIP_DEEP?"t-loged-vip-red":"t-loged-vip-gray"),a.ajax({url:"http://my.37.com/api/message_api.php?action=is_remind",dataType:"jsonp",timeout:3e3}).done(function(a){a&&0===a.code&&a.data>0&&d.find("a.t-mails span").eq(0).show().parent().addClass("t-mails-on")})}}},topMenu:function(){c&&a("#top-shortcut").prop("href","http://www.37.com/shortcut.php?game_id="+c);var b=a(".js-top-menu");b.on("mouseenter",function(b){b.preventDefault(),a(".t-menu-hd").eq(0).addClass("t-menu-focus"),a(".t-menu-bd").eq(0).addClass("pop-show")}).on("mouseleave",function(b){b.preventDefault(),a(".t-menu-hd").eq(0).removeClass("t-menu-focus"),a(".t-menu-bd").eq(0).removeClass("pop-show")})},tuiguang:function(){var b=a("#tuiguang-small"),d=a("#tuiguang-large");if(c&&b.length&&d.length){var e="http://ptres.37.com/content/cache/game_site_header/"+c+".js",f="content_callback_game_site_header_"+c;a.ajax({url:e,cache:!1,dataType:"jsonp",jsonpCallback:f}).done(function(a){if(a&&1===a.code&&a.data){var e=a.data,f="",g="";e.top_img&&e.top_img[0]&&e.top_img[0].img?(f=-1===e.top_img[0].img.indexOf(".swf")?'<a href="javascript:;"><img src="'+e.top_img[0].img+'" /></a>':'<embed width="100%" height="100%" quality="high" type="application/x-shockwave-flash" wmode="transparent" src="'+e.top_img[0].img+'" />',g='<a href="'+e.top_img[1].link+'" target="_blank"><img src="'+e.top_img[1].img+'" /></a>',b.html(f),d.html(g),(new Image).src="http://bdtg.37.com/direct_media/call_back?/cb/4/1723/20732.js?uid="+c):b.hide()}}),a(document).on("mouseenter","#tuiguang-small",function(){b.hide(),d.show()}).on({mouseleave:function(){d.hide(),b.show()},click:function(){(new Image).src="http://bdtg.37.com/s/4/1723/20732/3.js?uid="+c}},"#tuiguang-large")}},bookMark:function(a,b){var c=a||f.href,e=b||d.title;try{window.external.AddFavorite(c,e)}catch(g){try{window.sidebar.addPanel(e,c,"")}catch(g){return window.alert("请您尝试同时按下Ctrl和D键收藏本页")}}},setHome:function(a){var b=a.target,c=f.href;try{return b.style.behavior="url(#default#homepage)",b.setHomePage(c),!1}catch(d){return window.alert("您的浏览器不支持此操作！\n请您手动设置主页")}},eventClick:function(){var b=this,c=a(".game-site-top:first"),d=a(".t-moregames"),e=a("#pop-game");c.on("click","#sethome",function(a){a.preventDefault(),b.setHome(a)}).on("click","#bookmark",function(a){a.preventDefault(),b.bookMark()}).on("mouseenter mouseleave",".t-log",function(b){b.preventDefault(),a(this).toggleClass("t-log-focus")}),d.add(e).bind("mouseenter",function(){b.pt&&clearTimeout(b.pt),d.addClass("t-moregames-focus"),e.fadeIn("fast")}).bind("mouseleave",function(){b.pt&&clearTimeout(b.pt),b.pt=setTimeout(function(){d.removeClass("t-moregames-focus"),e.hide()},100)})},apiCommonData:function(){var b=this;a.ajax({url:"../../ptres.37.com/content/cache/header.js"/*tpa=http://ptres.37.com/content/cache/header.js*/,cache:!1,dataType:"jsonp",jsonpCallback:"content_callback_header"}).done(function(c){if(c&&1===c.code&&c.msg){var d=c.msg;b.topGameList(d.leader_game,a("#pop-1"),0,10),b.topGameList(d.leader_game,a("#pop-2"),10,20),b.topGameList(d.leader_game,a("#pop-3"),20,29)}})},topGameList:function(b,c,d,e){if(b&&b.length&&c.length){var f=b.slice(d,e),g="",h='<a target="_blank" class="lnk apic" href="{$site_index}">{$name}{$show_type}</a>';for(var i in f){var j="",k="";"new"==f[i].game_hot_new?j='<span class="corner corner-new-g"></span>':"hot"==f[i].game_hot_new&&(j='<span class="corner corner-new-o"></span>'),k=h.replace("{$site_index}",f[i].site_index).replace("{$name}",f[i].name).replace("{$show_type}",j),g+=k}a(g).prependTo(c)}}};a(document).ready(function(){g.init()}),b.Top=g}(jQuery,SQ);